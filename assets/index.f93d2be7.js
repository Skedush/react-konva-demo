var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,i=(e,t)=>{for(var r in t||(t={}))a.call(t,r)&&s(e,r,t[r]);if(n)for(var r of n(t))o.call(t,r)&&s(e,r,t[r]);return e},l=(e,n)=>t(e,r(n));import{r as c,K as u,a as p,l as d,b as m,p as f,R as h,I as y,c as g,T as x,h as v,S as b,L as E,d as S}from"./vendor.d8378487.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const w=({isChangeFrame:e,type:t,play:r,time:n,visible:a,jump:o,node:s,duration:i,onFinish:l,onUpdate:p,onReset:d})=>{const m=c.exports.useRef();c.exports.useEffect((()=>{t&&s&&(s.setAttr("animationPercent",0),s.cache(),m.current=new u.Tween({node:s,duration:i,animationPercent:100,onUpdate:()=>{e&&s.cache(),p&&p()},onFinish:()=>{s.clearCache(),l&&l()},onReset:()=>{d&&d()}}))}),[i,s,l,d,p,t]),c.exports.useEffect((()=>{t&&s&&m.current&&(a?n/1e3>i?(m.current.seek(i),s.clearCache()):(s.cache(),m.current.seek(n/1e3)):m.current.reset(),r&&!o?m.current.play():m.current.pause())}),[o,a,r,i,m])},{Filters:{Blur:k,Brighten:M,Contrast:L,Emboss:j,Enhance:C,Grayscale:T,HSL:R,HSV:P,Invert:F,Kaleidoscope:D,Mask:O,Noise:H,Pixelate:z,Posterize:B,RGB:Y,RGBA:A,Sepia:I,Solarize:$,Threshold:_}}=u;var N=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",Blur:k,Brighten:M,Contrast:L,Emboss:j,Enhance:C,Grayscale:T,HSL:R,HSV:P,Invert:F,Kaleidoscope:D,Mask:O,Noise:H,Pixelate:z,Posterize:B,RGB:Y,RGBA:A,Sepia:I,Solarize:$,Threshold:_,BackInDown:function(e){const t=this.getAttr("animationPercent")/100,r=this.getAttr("width");var n=e.data.length;e.data.fill(0,Math.floor(n*t/4/r)*r*4)},Shades:function(e){var t=e.data.length;const r=this.getAttr("animationPercent")/100,n=this.getAttr("width"),a=Math.floor(t/8/n/4)*n*4;for(let o=1;o<=8;o++){const t=a*(o-1)+Math.floor(a*r/4/n)*n*4,s=a*(o-1)/4/n;for(let i=a*(o-1);i<t;i+=4){const t=Math.floor(i/4)%n,a=Math.floor(i/4/n),o=parseInt(s+(a-s)/r);for(let r=0;r<4;r++)e.data[4*t+4*a*n+r]=e.data[4*t+4*o*n+r]}e.data.fill(0,t,8===o?void 0:a*o)}}});const{CancelToken:G}=p;function U(e){const{data:t,url:r,method:n="get"}=e;if(!r)throw new Error("request url none");const a=d.exports.cloneDeep(t),o=function(e,t){let r=e;try{let e="";const n=r.match(/[a-zA-z]+:\/\/[^/]*/);n&&([e]=n,r=r.slice(e.length));const a=f.parse(r);r=f.compile(r)(t);for(const r of a)r instanceof Object&&r.name in t&&delete t[r.name];r=e+r}catch(n){r=e}return r}(r,a);return e.url="get"===n.toLocaleLowerCase()?`${o}${d.exports.isEmpty(a)?"":"?"}${m.stringify(a)}`:o,e.cancelToken=new G((e=>{window.cancelRequest.set(Symbol(Date.now()),{pathname:window.location.pathname,cancel:e})})),e.headers={"X-Request-Type":"ajax"},p(e).then((t=>{let r=t.status;if("blob"===e.responseType)return{data:t.data};if(r>=300||r<200)throw new Error(t);return Promise.resolve(t)})).catch((e=>{throw new Error(e)}))}function X(e){const[t,r]=c.exports.useState(),n=c.exports.useRef(),a=c.exports.useRef(),{backColor:o,font:s,height:i,visible:l,width:u,x:p,y:d,text:m,jump:f,onSeeked:y,onLoaded:v,play:b,speed:E,time:S,animation:k}=e,{align:M,color:L,size:j}=s,C={0:["left","top"],1:["left","middle"],2:["left","bottom"],3:["center","top"],4:["center","middle"],5:["center","bottom"],6:["right","top"],7:["right","middle"],8:["right","bottom"]}[M];return c.exports.useEffect((()=>{v(!0)}),[]),c.exports.useEffect((()=>{l&&r(m)}),[l,m]),c.exports.useEffect((()=>{f&&(y(!1),y(!0))}),[f]),w({type:null==k?void 0:k.type,isChangeFrame:!0,play:b,speed:E,time:S,node:a.current,jump:f,visible:l,duration:(null==k?void 0:k.duration)/E}),w({type:null==k?void 0:k.type,isChangeFrame:!1,play:b,speed:E,time:S,node:n.current,jump:f,visible:l,duration:(null==k?void 0:k.duration)/E}),h.createElement(c.exports.Fragment,null,h.createElement(g,{visible:l,ref:n,fill:`rgb(${o.join(",")})`,x:p,filters:[N[null==k?void 0:k.type]],y:d,width:u,height:i}),h.createElement(x,{visible:l,ref:a,text:t,x:p,filters:[N[null==k?void 0:k.type]],y:d,width:u,height:i,fontSize:j,fill:`rgb(${L.join(",")})`,align:C[0],verticalAlign:C[1]}))}window.cancelRequest=new Map,p.defaults.withCredentials=!0;var q=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",Video:function(e){const{x:t,y:r,width:n,height:a,play:o,src:s,speed:i,onSeeked:l,visible:u,duration:p,jump:d,time:m,jumpTime:f,animation:g,onLoaded:x}=e,v=c.exports.useRef(),b=c.exports.useRef(),[E,S]=c.exports.useState(!1);return c.exports.useMemo((()=>{E&&(v.current.playbackRate=i)}),[E,i]),c.exports.useEffect((()=>{const e=document.createElement("video");(async()=>{const t=await U({url:s,responseType:"blob"}),r=URL.createObjectURL(t.data);e.src=r})(),e.crossOrigin="anonymous",e.playbackRate=i,e.addEventListener("loadedmetadata",(function(){S(!0),x(!0)})),e.addEventListener("seeking",(function(){l(!1)})),e.onseeked=()=>{l(!0)},v.current=e}),[]),c.exports.useEffect((()=>{d&&(l(!1),v.current.pause(),f>=0&&f<p?v.current.currentTime=f/1e3:l(!0))}),[d,f]),c.exports.useEffect((()=>{E&&(o&&u&&!d?v.current.play():!o&&u?v.current.pause():d||(v.current.currentTime=0,v.current.pause()))}),[o,E,u,d]),w({type:null==g?void 0:g.type,isChangeFrame:!0,play:o,speed:i,time:m,node:b.current,jump:d,visible:u,duration:(null==g?void 0:g.duration)/i}),h.createElement(y,{visible:u,ref:b,image:v.current,filters:[N[null==g?void 0:g.type]],x:t,y:r,width:n,height:a})},Image:function(e){const{x:t,y:r,width:n,height:a,src:o,speed:s,onSeeked:i,visible:l,jump:u,play:p,time:d,animation:m,onLoaded:f}=e,g=c.exports.useRef(),x=c.exports.useRef();return c.exports.useEffect((()=>{const e=document.createElement("img");e.src=o,e.onload=()=>{f(!0),g.current=e}}),[]),c.exports.useEffect((()=>{u&&(i(!1),i(!0))}),[u]),w({type:null==m?void 0:m.type,isChangeFrame:!1,play:p,speed:s,time:d,node:x.current,jump:u,visible:l,duration:(null==m?void 0:m.duration)/s}),h.createElement(y,{visible:l,ref:x,filters:[N[null==m?void 0:m.type]],image:g.current,x:t,y:r,width:n,height:a})},Text:X,Datetime:function(e){const[t,r]=c.exports.useState(),{dateFormat:n,dateLabel:a,timeSum:o,timeFormat:s,timeLabel:u,visible:p,initialValue:d="1990-06-15 00:00:00"}=e,m=c.exports.useRef(v(d,"YYYY-MM-DD HH:mm:ss")),f=s.replace(/M/g,"m").replace(/S/g,"s"),y=()=>{const e=m.current.format(n),t=m.current.format(f);return a+e+" "+u+t};return c.exports.useEffect((()=>{m.current=d?v(`${m.current.format(n)}`,"YYYY-MM-DD HH:mm:ss"):v(),d&&m.current.add(o,"milliseconds"),r(y())}),[o]),c.exports.useEffect((()=>{if(!p)return;let e=y();r(e)}),[p]),h.createElement(X,l(i({},e),{text:t}))}});const K=({scene:e,time:t,play:r,speed:n,onSeeked:a,onLoaded:o,visible:s,jump:u,jumpTime:p,timeSum:d})=>{const[m,f]=c.exports.useState(e.map((()=>!0))),[y,g]=c.exports.useState(e.map((()=>!1)));return c.exports.useEffect((()=>{u&&a(!1)}),[u]),c.exports.useEffect((()=>{const e=m.some((e=>!1===e));a(!e)}),[m]),c.exports.useEffect((()=>{y.some((e=>!1===e))||o(!0)}),[y]),h.createElement(c.exports.Fragment,null,e&&e.map(((e,a)=>{const o=(e=>{let t=e.trim().toLowerCase().replace(e[0],e[0].toUpperCase());return q[t]})(e.type);return h.createElement(o,l(i({visible:t>=0&&t<e.duration&&s,key:a,jump:u,jumpTime:p},e),{onSeeked:e=>((e,t)=>{f((r=>{const n=[...r];return n[t]=e,n}))})(e,a),onLoaded:e=>((e,t)=>{g((r=>{const n=[...r];return n[t]=e,n}))})(e,a),play:r,timeSum:d,time:t,speed:n}))})))};function V(e){const t=v.duration(e),r=e=>e<10?"0"+e:e;return`${r(t.hours())}:${r(t.minutes())}:${r(t.seconds())}`}const Z=e=>{const{time:t,scenesDurationSum:r,setProgress:n,onPlayPause:a,setSpeed:o,play:s}=e,i=c.exports.useRef(),[l,u]=c.exports.useState("倍速"),[p,d]=c.exports.useState(t),[m,f]=c.exports.useState(!1),y=V(r),g=V(m?p:t),x=()=>{i.current.style.display="none"};return h.createElement("div",{id:"video-slider",onMouseLeave:x},s&&h.createElement("div",{id:"video-btn-pause",onClick:()=>a()},"|  |"),!s&&h.createElement("div",{id:"video-btn-play",onClick:()=>a()}),h.createElement("div",{id:"video-progress"},h.createElement("input",{type:"range",value:m?p:t,max:r,id:"video-progress-control",step:"any",onChange:e=>{d(parseFloat(e.target.value))},onMouseUp:e=>{f(!1),n(parseFloat(e.target.value))},onMouseDown:()=>{f(!0),d(t)}}),h.createElement("span",{id:"time-duration"},y),h.createElement("span",{id:"time-propgress"},g)),h.createElement("div",{id:"time-speed",onMouseOver:()=>{"none"===i.current.style.display&&(i.current.style.display="block")},onMouseLeave:x},l,h.createElement("div",{id:"time-speed-select",ref:i,onClick:e=>{let t=e.target.innerHTML.substring(0,e.target.innerHTML.length-1);"1.0X"===e.target.innerHTML?u("倍速"):u(e.target.innerHTML),i.current.style.display="none",o(t)},onMouseLeave:x},h.createElement("div",null,"0.5X"),h.createElement("div",null,"1.0X"),h.createElement("div",null,"2.0X"),h.createElement("div",null,"4.0X"))))};function J(e){const[t,r]=c.exports.useState(null),[n,a]=c.exports.useState(0),[o,s]=c.exports.useState(1),[l,p]=c.exports.useState([]),[d,m]=c.exports.useState(!1),[f,y]=c.exports.useState([]),[g,x]=c.exports.useState(!1),[v,S]=c.exports.useState(0),[w,k]=c.exports.useState(!1),[M,L]=c.exports.useState(0),[j,C]=c.exports.useState(null),[T,R]=c.exports.useState(null),[P,F]=c.exports.useState(0),D=c.exports.useRef(),O=c.exports.useRef(),{data:H}=e;c.exports.useMemo((()=>{const e=(e=>{if(!e)return;const t=e.info.scenes.map((e=>e.items.map((e=>{const t=i({},e);return"datetime"===t.type&&(t.dateLabel=t.params.dateLabel,t.timeLabel=t.params.timeLabel,t.timeFormat=t.params.timeFormat,t.dateFormat=t.params.dateFormat),t.params&&(t.src=t.params.file,t.font=t.params.font,t.text=t.params.content,t.transition=t.params.transition,t.playMode=t.params.playMode,t.backColor=t.params.backColor,t.duration=t.params.duration),delete t.params,t}))));return{width:e.width,height:e.height,scenes:t}})(H);r(e),p(e.scenes.map((()=>!0))),y(e.scenes.map((()=>!1)))}),[H]),c.exports.useMemo((()=>{const e=H.info.scenes.map((e=>{const t=e.items.map((e=>e.params.duration));return Math.max(...t)}));C(e),R(e.reduce(((e,t)=>e+t)))}),[H]);const z=c.exports.useCallback((e=>{let t,r=0;for(let n=0;n<j.length;n++)if(r+=j[n],e-r<0){t=n;break}return t}),[j]);c.exports.useEffect((()=>{L(z(n))}),[n,j,z]);const B=c.exports.useCallback(((e,t)=>{p((r=>{const n=[...r];return n[t]=e,n}))}),[]),Y=c.exports.useCallback(((e,t)=>{y((r=>{const n=[...r];return n[t]=e,n}))}),[]);c.exports.useEffect((()=>{!l.some((e=>!1===e))&&g&&(a(v),L(z(v)),x(!1),w&&I.start())}),[l]),c.exports.useEffect((()=>{f.some((e=>!1===e))||m(!0)}),[f]);const A=(e,t)=>{let r=e;for(let n=0;n<t;n++)r-=j[n];return r},I=c.exports.useMemo((()=>new u.Animation((e=>{F(e.timeDiff)}),D.current)),[]);c.exports.useEffect((()=>{a((e=>e+P*o))}),[o,P]),c.exports.useEffect((()=>{n>T&&a(0)}),[n,T]);const $=c.exports.useCallback((()=>{k((e=>(e?I.stop():I.start(),!e)))}),[I]);return h.createElement("div",{className:"container"},!d&&h.createElement("div",{className:"mask",style:{width:H.width,height:H.height}},"加载中..."),t&&h.createElement(b,{width:H.width,height:H.height,ref:O},h.createElement(E,{ref:e=>{D.current=e}},t.scenes.map(((e,t)=>h.createElement(K,{key:t,visible:t===M,jump:g,jumpTime:A(v,t),speed:o,scene:e,time:A(n,t),timeSum:n,play:w&&t===M,onSeeked:e=>B(e,t),onLoaded:e=>Y(e,t)}))))),h.createElement(Z,{jump:g,play:w,time:g?v:n,scenesDurationSum:T,setProgress:e=>{S(e),x(!0),I.stop()},onPlayPause:$,setSpeed:s}))}S.render(h.createElement(h.StrictMode,null,h.createElement(J,{data:{id:"61243f84f09ad60019bec804",name:"20210824",width:800,height:600,updateTime:"2021-08-24T00:43:35.587Z",createTime:"2021-08-24T00:38:28.945Z",publishTime:null,info:{scenes:[{items:[{animation:{type:"Shades",duration:3},type:"video",width:800,height:600,x:0,y:0,params:{file:"1.mkv",audit:!1,duration:37e3}}]},{items:[{animation:{type:"Shades",duration:3},params:{file:"1.mkv",audit:!1,duration:37e3},type:"video",width:800,height:600,x:0,y:0},{animation:{type:"Shades",duration:3},type:"image",width:371,height:371,x:429,y:0,params:{duration:3e4,transition:{type:24,speed:"fast"},file:"3.gif",audit:!1}}]},{items:[{animation:{type:"BackInDown",duration:5},type:"video",width:800,height:600,x:0,y:0,params:{file:"2.mp4",audit:!1,duration:15e3}},{animation:{type:"BackInDown",duration:5},type:"text",width:218,height:96,x:0,y:0,params:{duration:3e4,transition:{type:24,speed:"fast"},content:"哈哈啊哈",font:{name:"simsun.ttc",size:24,color:[255,255,255],lspace:5,fspace:0,align:1},backColor:[60,101,182,255]}},{animation:{type:"Shades",duration:5},type:"datetime",width:245,height:100,x:555,y:0,params:{timeFormat:"HH:MM:SS",dateFormat:"YYYY-M-D",dateLabel:"",timeLabel:"",font:{name:"simsun.ttc",size:24,color:[255,255,255],lspace:5,fspace:0,align:0},duration:3e4,transition:{type:24,speed:"middle"},playMode:"single",backColor:[60,101,182,255]}}]}]},version:0,canPublish:!0}})),document.getElementById("root"));
